<html>

<head>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes"/>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@6.2.3/dist/math.min.js" integrity="sha256-jnrFf6CiZ2veyKUaL7l7FHWW/ela8txaw/J7SVZzW5o=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mini.css/3.0.1/mini-default.min.css" integrity="sha256-Tb0Wikpef+a1/IiQ0gXyT9PsM654/3hNHHdxMwEhBLA=" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highcharts/7.2.0/highcharts.js" integrity="sha256-pWlJ6y5bcww1f1YFl+ak3DjzWUFtLTiy1u1amuLuSfA=" crossorigin="anonymous"></script>
    <script src="./model.js"></script>
    <script>
        function onCloseIntro () {
            if (document.getElementById('dont-show-anymore').checked)
                document.cookie = 'dontShowIntro=true'
            return true
        }

        function toonResultaat () {
            const km = parseInt(document.querySelector('[name="km"]').value)
            const min = parseInt(document.querySelector('[name="min"]').value)
            toonResultBox(km, min)
            toonVasteKmGrafiek(km)
            toonVasteTijdGrafiek(km, min)
            return false
        }

        function toonResultBox (km, min) {
            const lines = []
            document.cookie=`km=${km}`
            document.cookie=`min=${min}`
            for (naam in settings) {
                lines.push(`<strong>${ naam }:</strong>&nbsp;${berekenAfgerond(naam, km, min)}&euro;`)
            }
            document.getElementById('resultaat').innerHTML = lines.join('<br>')
        }

        function toonGrafiek (series, id, titleText) {
            Highcharts.chart(id, {
                title: { text: titleText },
                yAxis: { title: { text: 'Kost' } },
                legend: {
                    useHTML: true,
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle'
                },
                plotOptions: {
                    series: {
                        label: {
                            connectorAllowed: false
                        },
                        pointStart: 0
                    }
                },
                series,
                responsive: {
                    rules: [{
                        condition: {
                            maxWidth: 500
                        },
                        chartOptions: {
                            legend: {
                                layout: 'horizontal',
                                align: 'center',
                                verticalAlign: 'bottom'
                            }
                        }
                    }]
                }
            });
        }

        function toonVasteKmGrafiek (km) {
            const series = []
            for (const name in settings) {
                const data = []
                const color = settings[name].color
                for (let time = 0; time < 24 * 60 ; time += 5) data.push(berekenAfgerond(name, km, time))
                series.push({ name, data, color })
            }
            toonGrafiek(series, 'vasteKmGrafiek', `Kost per tijd voor ${km}km`)
        }

        function toonVasteTijdGrafiek (km, min) {
            const series = []
            const maxKm = min / 60 * 120 // maximum 120 km/h
            for (const name in settings) {
                const data = []
                const color = settings[name].color
                for (let km = 0; km <= maxKm; km++) data.push(berekenAfgerond(name, km, min))
                series.push({ name, data, color })
            }
            toonGrafiek(series, 'vasteTijdGrafiek', `Kost per km voor ${min}min`)
        }

        window.onload = () => {
            if (0 <= document.cookie.indexOf('dontShowIntro=true'))
            document.getElementById('modal-control').removeAttribute('checked')
            const [_, km] = document.cookie.match(/km=(\d*)/) || []
            const [__, min] = document.cookie.match(/min=(\d*)/) || [] 
            if (km) document.getElementById('km').value = km
            if (min) document.getElementById('min').value = min
        }
    </script>
    <style>
        form { display: flex; flex-direction: column; }
        form > span { display: flex; flex-direction: row; align-items: baseline; }
        .buttons { flex-grow: 1; display: flex; justify-content: flex-end; }
        #km, #min { width: 5em; }
        @media screen and (min-width: 42rem) {
            #km + label::after { content: "," }
            form { flex-direction: row; align-items: baseline; }
        }
    </style>
</head>
<html>
    <input type="checkbox" id="modal-control" class="modal" checked onclick="onCloseIntro()">
    <div>
        <div class="card">
            <p class="section">
                Vul hier de geplande afstand en tijd in.<br>
                Zo kan je berekenen wat een rit met &eacute;&eacute;n van de Gentse autodeelplatformen zal kosten.
            </p>
            <div class="container">
                <div class="input-group row">
                    <label for="modal-control" class="button small primary col-sm-2">OK</label>
                    <input type="checkbox" id="dont-show-anymore">
                    <label for="dont-show-anymore">Niet meer tonen</label>
                </div>
            </div>
        </div>
    </div>
    <form>
        <span>  
            <label for="km">afstand</label>
            <input type="number" name="km" id="km" value="10">
            <label for="km">km</label>
        </span>
        <span>
            <label for="min">gedurende</label>
            <input type="number" name="min" id="min" value="15">
            <label for="min">minuten</label>
        </span>
        <span class="buttons">
            <input type="button" id="modal-control" onclick="javascript: return toonResultaat()" value="toon resultaat">
        </span>
    </form>

    <div id="resultaat"></div>
    <div id="vasteKmGrafiek"></div>
    <div id="vasteTijdGrafiek"></div>

</html>

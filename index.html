<html>

<head>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes"/>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@6.2.3/dist/math.min.js" integrity="sha256-jnrFf6CiZ2veyKUaL7l7FHWW/ela8txaw/J7SVZzW5o=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mini.css/3.0.1/mini-default.min.css" integrity="sha256-Tb0Wikpef+a1/IiQ0gXyT9PsM654/3hNHHdxMwEhBLA=" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highcharts/7.2.0/highcharts.js" integrity="sha256-pWlJ6y5bcww1f1YFl+ak3DjzWUFtLTiy1u1amuLuSfA=" crossorigin="anonymous"></script>
    <script>
        const settings = {
            Partago: {
                variables: {
                    start: 30,
                    kwPerKm: 15.0 / 100, // TODO: afhankelijk van rijprofiel
                    creditsPerKw: 15,
                    euroPerCredit: 300.0 / 4800, // TODO: afhankelijk van laden
                },
                formule: '(start + km * kwPerKm * creditsPerKw + min) * euroPerCredit'
            },
            'D&eacute;gage': {
                variables: {
                    tot100: 0.32,  // prijs per km tem 100km
                    tot200: 0.28, // prijs per km van 101 tem 200km
                    meer: 0.24 // prijs per km vanaf 201km
                },
                formule: 'km <= 100 ? tot100 * km : tot100 * 100 + (km <= 200 ? tot200 * (km - 100) : (tot200 * 100 + meer * (km - 200)))'
            },
            'Cambio Start': {
                variables: {
                    tot100: 0.35,  // prijs per km tem 100km
                    meer: 0.23, // prijs per km vanaf 100km
                    uurPrijs: 1.75
                },
                formule: '(uurPrijs * ((min - min % 60) / 60 + 1)) + (km <= 100 ? tot100 * km : (tot100 * 100 + meer * (km - 100)))'
            },
            'Cambio Bonus': {
                variables: {
                    tot100: 0.26,  // prijs per km tem 100km
                    meer: 0.23, // prijs per km vanaf 100km
                    uurPrijs: 1.75
                },
                formule: '(uurPrijs * ((min - min % 60) / 60 + 1)) + (km <= 100 ? tot100 * km : (tot100 * 100 + meer * (km - 100)))'
            },
            'Cambio Comfort': {
                variables: {
                    tot100: 0.23,  // prijs per km tem 100km
                    meer: 0.18, // prijs per km vanaf 100km
                    uurPrijs: 1.55
                },
                formule: '(uurPrijs * ((min - min % 60) / 60 + 1)) + (km <= 100 ? tot100 * km : (tot100 * 100 + meer * (km - 100)))'
            },
            BattFan: {
                variables: {
                    dagPrijs: 30.25
                },
                formule: 'dagPrijs + dagPrijs * (min - min % (60 * 24)) / (60 * 24)'
            }
        }
           
        function onCloseIntro () {
            if (document.getElementById('dont-show-anymore').checked)
                document.cookie = 'dontShowIntro=true'
            return true
        }

        function toonResultaat () {
            const km = parseInt(document.querySelector('[name="km"]').value)
            const min = parseInt(document.querySelector('[name="min"]').value)
            toonResultBox(km, min)
            toonVasteKmGrafiek(km)
            toonVasteTijdGrafiek(km, min)
            return false
        }

        function toonResultBox (km, min) {
            const lines = []
            for (naam in settings) {
                lines.push(`<strong>${ naam }:</strong>&nbsp;${bereken(naam, km, min)}&euro;`)
            }
            document.getElementById('demo').innerHTML = lines.join('<br>')
        }

        function toonGrafiek (series, id, titleText) {
            console.log('toonGrfiek', id, document.getElementById(id))
            Highcharts.chart(id, {
                title: { text: titleText },
                yAxis: { title: { text: 'Kost' } },
                legend: {
                    useHTML: true,
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle'
                },
                plotOptions: {
                    series: {
                        label: {
                            connectorAllowed: false
                        },
                        pointStart: 0
                    }
                },
                series,
                responsive: {
                    rules: [{
                        condition: {
                            maxWidth: 500
                        },
                        chartOptions: {
                            legend: {
                                layout: 'horizontal',
                                align: 'center',
                                verticalAlign: 'bottom'
                            }
                        }
                    }]
                }
            });
        }

        function toonVasteKmGrafiek (km) {
            const series = []
            for (const name in settings) {
                const data = []
                for (let time = 0; time < 24 * 60 ; time += 5) data.push(bereken(name, km, time))
                series.push({ name, data })
            }
            toonGrafiek(series, 'vasteKmGrafiek', `Kost per tijd voor ${km}km`)
        }

        function toonVasteTijdGrafiek (km, min) {
            const series = []
            const maxKm = min / 60 * 120 // maximum 120 km/h
            for (const name in settings) {
                const data = []
                for (let km = 0; km <= maxKm; km++) data.push(bereken(name, km, min))
                series.push({ name, data })
            }
            toonGrafiek(series, 'vasteTijdGrafiek', `Kost per km voor ${min}min`)
        }

        function bereken (name, km, min) {
            const { formule, variables } = settings[name]
            return Math.round(math.evaluate(formule, { ...variables, km, min }) * 100) / 100
        }

        window.onload = () => {
            if (0 <= document.cookie.indexOf('dontShowIntro=true'))
                document.getElementById('modal-control').removeAttribute('checked')
        }
    </script>
</head>
<html>
    <input type="checkbox" id="modal-control" class="modal" checked onclick="onCloseIntro()">
    <div>
        <div class="card">
        <p class="section">
            Vul hier de geplande afstand en tijd in.<br>
            Zo kan je berekenen wat een rit met &eacute;&eacute;n van de Gentse autodeelplatformen zal kosten.
        </p>
        <div class="container">
                <div class="input-group row">
                    <label for="modal-control" class="button small primary col-sm-2">OK</label>
                    <input type="checkbox" id="dont-show-anymore">
                    <label for="dont-show-anymore">Niet meer tonen</label>
                </div>
        </div>
        </div>
    </div>
    <form>
        <div class="input-group vertical">
                <label for="km" class="doc">km</label>
                <input type="number" name="km" id="km" value="10" class="doc">
        </div>
        <div class="input-group vertical">
                <label for="min" class="doc">minuten</label>
                <input type="number" name="min" value="15" class="doc">
        </div>
        <!-- <div class="input-group vertical">
            <label for="kwPer100Km">kW per 100 km</label>
            <input type="number" name="kwPer100Km" id="kwPer100Km" value="15" class="doc">
        </div> -->
    </form>

    <!-- <label for="modal-control" class="button doc">toonResultaat</label> -->
    <!-- <input type="checkbox" id="modal-control" class="modal" onchange="javascript: return toonResultaat()"> -->
    <input type="button" id="modal-control" onclick="javascript: return toonResultaat()" value="toon resultaat">
    <!-- <div>
    <div class="card large"> -->
        <!-- <label for="modal-control" class="modal-close" ></label> -->
        <!-- <h3 class="section">Resultaat</h3> -->
        <div id="demo"></div>
    <!-- </div>
    </div> -->

    <div id="vasteKmGrafiek"></div>
    <div id="vasteTijdGrafiek"></div>

</html>
